---
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r}
# load libraries
library(tidyverse)
library(here)
library(knitr)
library(kableExtra)
library(plotly)
library(ggiraph)
```

```{r}
# load library
fao_emissions <- read_csv(here::here("MEDS/capstone/emissions-dashboard/data/full_emissions_fao_species.csv"))
```

```{r}
# Explore data
print(unique(fao_emissions$name_en))
```


```{r}
# Calc top species
top_species <- fao_emissions |>
  group_by(name_en) |>
  summarize(sum_emissions = sum(total_co2_mt, na.rm = TRUE)) |>
  arrange(desc(sum_emissions)) |>
  head(20)
```

```{r}
# Calc top major groups
top_groups <- fao_emissions |>
  group_by(major_group) |>
  summarize(sum_emissions = sum(total_co2_mt, na.rm = TRUE)) |>
  arrange(desc(sum_emissions)) |>
  head(20)
```

```{r}
# Calc top countries
top_flags <- fao_emissions |>
  group_by(flag) |>
  summarize(sum_emissions = sum(total_co2_mt, na.rm = TRUE)) |>
  arrange(desc(sum_emissions))
```

```{r}
# ---- Seafood explorer data ----

# Create the fake data
df <- data.frame(
  country = c("China", "USA", "Japan", "Iceland", "Argentina", "Australia"),
  emissions = c(500, 175, 150, 105, 75, 73)
)

```

```{r}
# Create the ggplot
  country_plot <- ggplot() +
    geom_bar(data = df,
             aes(x = emissions, y = reorder(country, emissions)),
             stat = 'identity',
             fill = "#08C4E5") +
    labs(x = "Emissions") +
    theme_void() +
    theme(
      legend.position = "none",
      axis.title.x = element_text(color = "white", family = "Roboto", face = "bold", size = 18),
      axis.text.y = element_text(color = "white", family = "Roboto", face = "bold", size = 14),
      panel.background = element_rect(fill = "#053762", color = NA),
      plot.background = element_rect(fill = "#053762", color = NA)
    )
  
  # Convert ggplot to plotly
  ggplotly(country_plot, tooltip = "text")
  
  
```

```{r}
library(ggiraph)

# ---- Seafood explorer data ----
df <- data.frame(
  country = c("China", "USA", "Japan", "Iceland", "Argentina", "Australia"),
  emissions = c(500, 175, 150, 105, 75, 73))

country_plot_2 <- ggplot() +
  geom_bar_interactive(
    data = df,
    aes(
      x = emissions,
      y = reorder(country, emissions),
      tooltip = paste0(country, ": ", emissions, " emissions"),
      data_id = country),
    stat = 'identity',
    fill = "#08C4E5") +
  labs(x = "Emissions") +
  theme_void() +
  theme(
    legend.position = "none",
    axis.title.x = element_text(color = "white", face = "bold", size = 18),
    axis.text.y = element_text(color = "white", face = "bold", size = 14),
    panel.background = element_rect(fill = "#053762", color = NA),
    plot.background = element_rect(fill = "#053762", color = NA))


# ---- Render as interactive plot ----
girafe(ggobj = country_plot_2,
        options = list(
    opts_hover(css = "filter: drop-shadow(0px 0px 6px #333333);"),
    opts_hover_inv(css = "opacity:0.3;"),
    opts_tooltip(css = "background-color: white;
                 color: #053762;
                 font-weight: bold;
                 border: 1px solid #08C4E5;
                 padding: 6px;
                 border-radius: 6px;")
  )
)

```

```{r}
country_plot_2
```


```{r}
# Test total for emissions
arg_emissions <- country_emissions |>
  filter(flag == "ARG",
         year == 2016) |>
   summarise(total_emissions = sum(emissions_co2_mt, na.rm = TRUE))

```

